<div class="main-sidebar-wrapper nano" style="height: calc(100% - 60px);">
  <div class="main-sidebar nano-content" tabindex="0">
    <div class="summary">
      <h1>Cloud Profiles</h1>
    </div>
    <div class="meta">
      <div class="meta-item">
        <p class="info">{{data.length}} Total Cloud Profiles</p>
      </div>
    </div>
    <div class="sidebar-group">
      <div>
        Cloud Profiles Summary
      </div>
    </div>
  </div>
</div>
<div class="main-sidebar-spacer"></div>
<div class="right-panel">
<div *ngIf="data.length !== 0">
  <div *ngIf="_sherlockRole !== ''" class="toolbar" style="padding-bottom:0px;">
    <button style="margin-left:10px;" nz-button [nzType]="'primary'" [nzSize]="'large'" (click)="onClickCreateCloud()">
      <i class="anticon anticon-plus"></i>
      <span>Create</span>
    </button>
    <button *ngIf="isShowingDeleteButton()" style="margin-left:10px;" nz-button [nzType]="'default'" [nzSize]="'large'" [nzLoading]="isConfirmLoading"
      (click)="onClickRemoveTableRow()">
      <i class="anticon anticon-close"></i>
      <span>Remove</span>
    </button>
  </div>
  <div *ngIf="_sherlockRole !== ''" class="spacer"></div>
  <div class="table-container">
    <nz-table #nzTable [nzDataSource]="data" [nzPageSize]="10" (nzDataChange)="_displayDataChange($event)" [nzCustomNoResult]="true"
      (nzPageIndexChange)="_refreshStatus()" (nzPageSizeChange)="_refreshStatus()">
      <thead nz-thead>
        <tr>
          <th nz-th [nzCheckbox]="true">
            <label nz-checkbox [(ngModel)]="_allChecked" [nzIndeterminate]="_indeterminate" (ngModelChange)="_checkAll($event)">
            </label>
          </th>
          <th nz-th *ngFor="let col of columns">
            <span>{{col}}</span>
            <nz-table-sort [(nzValue)]="sortMap[col]" (nzValueChange)="sort(col,$event)"></nz-table-sort>
          </th>
          <th nz-th></th>
        </tr>
      </thead>
      <tbody nz-tbody>
        <tr nz-tbody-tr *ngFor="let data of nzTable.data">
          <td nz-td [nzCheckbox]="true">
            <label nz-checkbox  [(ngModel)]="data.checked" (ngModelChange)="_refreshStatus($event)">
            </label>
          </td>
          <td nz-td>{{data.name}}</td>
          <td nz-td>{{data.type}}</td>
          <td nz-td>{{data.description}}</td>
          <td nz-td class="options-column">
            <nz-radio-group [(ngModel)]="_rowIndex" (ngModelChange)="_refreshStatus($event)" *ngFor="let option of tableRowEditingOptions; index as i">
                <p *ngIf= "_sherlockRole === '' && (i === 1 || i === 2)" [ngClass]= "i === 2 ? 'disablebuttons' : ''"  nz-radio-button [nzValue]="data.id" (click)= "i === 2 ? false : updateRowIndex(data.id, option)">{{option.label}}</p>
                <p *ngIf= "_sherlockRole !== '' && (i === 0 || i === 2)" [ngClass]= "(data.disable && i === 2) ? 'disablebuttons' : ''"  nz-radio-button [nzValue]="data.id" (click)= "(data.disable && i === 2) ? false : updateRowIndex(data.id, option)">{{option.label}}</p>
            </nz-radio-group>
        </td>
        </tr>
      </tbody>
      <div noResult>No Data</div>
    </nz-table>
  </div>
</div>
<div *ngIf="data.length === 0 && !isLoading" class="center-container">
  <div class="center-item">
      <div *ngIf="_sherlockRole !== ''">No Cloud Profiles have been Added yet.</div>
      <div *ngIf="_sherlockRole === ''">No Cloud Profiles associated with current user.</div>
      <div *ngIf="_sherlockRole !== ''" style="margin-top: 20px">
        <button nz-button [nzType]="'primary'" [nzSize]="'large'" (click)="onClickCreateCloud()">
          <i class="anticon anticon-plus"></i>
          <span>Create Cloud Profile</span>
        </button>
      </div>
  </div>
</div>
<div *ngIf="data.length === 0 && isLoading" class="center-container">
  <nz-spin></nz-spin>
</div>
</div>
<nz-modal [nzVisible]="isDeleteModalVisible" [nzTitle]="'Remove Cloud Profile'" [nzContent]="deletemodalContent" (nzOnCancel)="handleDeleteCloudCancel()"
  (nzOnOk)="handleDeleteCloudOk()" [nzFooter]= "viewModal ? null : ''" [nzOkText]="'Remove'" [nzCancelText]="'Cancel'" [nzConfirmLoading]="isModalConfirmLoading">
  <ng-template #deletemodalContent>
    <div  *ngIf="isLoading" class="modal-spin">
      <nz-spin></nz-spin>
    </div>
    <div  *ngIf="!isLoading">
      <nz-alert  *ngIf ="viewModal" [nzType]="'error'" [nzCloseable]="true" (nzOnClose)="onCloseAlert()" nzShowIcon>
        <span alert-body>
          <pre>Cannot Remove {{ multipleProfiles ? 'Cloud Profiles.' : 'the Cloud Profile.' }}</pre>
        </span>
      </nz-alert>
      <nz-alert  *ngIf ="!viewModal" [nzType]="'warning'" [nzCloseable]="true" (nzOnClose)="onCloseAlert()" nzShowIcon>
        <span alert-body>
            <pre>Removing {{ multipleProfiles ? 'Cloud Profiles.' : 'the Cloud Profile.' }}</pre>
        </span>
      </nz-alert>
      <div *ngIf ="viewModal" class="associationList">
        <div  nz-row [ngStyle]="{'margin-top': alertClosed ? '0' : '20px'}">
              <span>Removing {{multipleClouds ? "these Cloud profiles." : "this Cloud profile"}} may have implications over Container Registry profiles.</span>
        </div>
        <p><span>Remove the following Cloud Profiles from selection to continue.</span> </p>
        <ul>
          <li *ngFor ="let p of associatedProfiles">{{p.name}}</li>
        </ul>
        <p><span>Associated Container Registry Profiles : {{associatedProfiles.length}}</span></p>
      </div>
      <div *ngIf ="!viewModal" nz-row [ngStyle]="{'margin-top': alertClosed ? '0' : '20px'}">
        Are you sure you want to remove {{multipleClouds ? "these Cloud profiles?" : "the Cloud profile?"}}
      </div>
      <div class="cloudsFooter"  *ngIf ="viewModal">
          <button class="footer-button" nz-button [nzType]="'primary'" [nzSize]="'large'" (click)="handleDeleteCloudCancel()"><span>Done</span></button>
      </div>
    </div>
  </ng-template>
</nz-modal>
<nz-modal [nzStyle] = "{'width':'800px'}" [nzVisible]="isCreateModalVisible" [nzTitle]="getPopupTitle()" [nzContent]="modalContent" (nzOnCancel)="handleCreateCloudCancel()"
[nzFooter]="null" [nzConfirmLoading]="isModalConfirmLoading">
<ng-template #modalContent>
  <nz-alert  *ngIf ="viewModal && _sherlockRole !== ''" [nzType]="'warning'" [nzCloseable]="true" (nzOnClose)="onCloseAlert()" nzShowIcon>
      <span  alert-body>
        <pre class="notification">Profile is associated with Container Registry Profile(s)/Project(s).</pre>
      </span>
  </nz-alert>
  <nz-alert  *ngIf ="_sherlockRole === '' && viewModal" [nzType]="'warning'" [nzCloseable]="true" (nzOnClose)="onCloseAlert()" nzShowIcon>
      <span  alert-body>
        <pre class="notification">Read-only for Project Users.</pre>
      </span>
  </nz-alert>
  <div class="content">
    <div class="input-group">
      <div>
        Cloud Type
      </div>
      <div style="height: 32px;">
        <select [disabled]= "viewModal || _sherlockRole === ''" [(ngModel)]="cloudType" style="width: 100%; border: 1px solid #cccccc;" (ngModelChange)="onChangeCloudType()">
         <!-- <option value="" disabled [selected]="cloudType === type">Select...</option>-->
          <option *ngFor="let t of cloudTypes; let i= index" value="{{t}}" [selected]="cloudType === t" [disabled] = "i === 0? true:''">{{i === 0 ? 'Select...' : (t === 'AWS' ? 'Amazon Web Services': 'Google Cloud Platform')}}</option>
        </select>
      </div>
    </div>
  </div>
  <div nz-row style="margin-top: 20px;">
    Cloud Profile Name
  </div>
  <div nz-row>
    <input  [disabled]= "_sherlockRole ===''" [(ngModel)]="cloudProfileName" placeholder="Cloud Profile Name" (ngModelChange)="checkDuplicates()" [ngClass]="duplicateProfileNameFound ? 'error-border' : 'editField'">
    <div *ngIf="duplicateProfileNameFound" class='error-style'>
      Profile name already exists. Please enter a new Name.
    </div>
  </div>
  <div nz-row style="margin-top: 20px; margin-bottom:5px;">
    Cloud Profile Description
  </div>
  <div nz-row>
    <nz-input [disabled]= "_sherlockRole ===''" [(ngModel)]="cloudProfileDescription" [nzPlaceHolder]="'Cloud Profile Description'"></nz-input>
  </div>
  <div *ngIf="cloudType === 'AWS'">
    <div nz-row style="margin-top: 20px;">
      Access Key
    </div>
    <div nz-row>
      <nz-input [disabled]= "_sherlockRole === ''" [(ngModel)]="awsAccessKeyInput" [nzPlaceHolder]="'Access Key'"></nz-input>
    </div>
    <div nz-row style="margin-top: 20px;">
      Secret
    </div>
    <div nz-row>
      <nz-input [disabled]= "_sherlockRole === ''" [(ngModel)]="awsSecretInput" [nzPlaceHolder]="'Secret'"></nz-input>
    </div>
  </div>
  <div *ngIf="cloudType === 'GCP'">
    <div nz-row style="margin-top: 20px;">
      GCP Service Account Info JSON
    </div>
    <div nz-row>
      <nz-input [disabled] ="viewModal || _sherlockRole === ''" [(ngModel)]="gcpSvcAcctInfo" [nzType]="'textarea'" [nzRows]="'4'" [nzPlaceHolder]="''" (ngModelChange)="changeGcpJson()"></nz-input>
      <div *ngIf="notJson" class='error-style'>
          This is not a json file.
      </div>
    </div>
  </div>
  <div class="cloudsFooter">
    <button *ngIf ="_sherlockRole !== ''"  class="footer-button" nz-button [nzSize]="'large'" (click)="handleCreateCloudCancel()"><span>Cancel</span></button>
    <button *ngIf ="_sherlockRole !== ''"  class="footer-button" nz-button [disabled] = "isDisabled()" [nzType]="'primary'" [nzSize]="'large'" (click)="handleCreateCloudOk()" [nzLoading]="isModalConfirmLoading"><span>{{this.cloudToUpdate ? 'Update' : 'Create'}}</span></button>
    <button *ngIf ="_sherlockRole == ''"  class="footer-button" nz-button [nzSize]="'large'" (click)="handleCreateCloudCancel()" [nzType]="'primary'"><span>Done</span></button>

  </div>
</ng-template>
</nz-modal>
